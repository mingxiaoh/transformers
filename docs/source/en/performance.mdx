<!---
Copyright 2021 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

# Performance and Scalability

Training larger and larger transformer models and deploying them to production comes with a range of challenges. During training your model can require more CUDA memory than is available or be very slow to train and when you deploy it for inference it can be overwhelmed with the throughput that is required in the production environment. This documentation is designed to help you navigate these challenges and find the best setting for your use-case. We split the guides into training and inference as they come with different challenges and solutions. Then within each of them we have separate guides for different kinds of hardware setting (e.g. single vs. multi-CUDA for training or CPU vs. CUDA for infrence).

![perf_overview](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/perf_overview.png)

This document serves as an overview and entry point for the methods that could be useful for your scenario.

## Training

Training transformer models efficiently requires an accelerator such as a CUDA or TPU. The most common case is where you only have a single CUDA, but there is also a section about multi-CUDA and CPU training (with more coming soon).

<Tip>

 Note: Most of the strategies introduced in the single CUDA sections (such as mixed precision training or gradient accumulation) are generic and apply to training models in general so make sure to have a look at it before diving into the following sections such as multi-CUDA or CPU training.

</Tip>

### Single CUDA

Training large models on a single CUDA can be challenging but there are a number of tools and methods that make it feasible. In this section methods such as mixed precision training, gradient accumulation and checkpointing, efficient optimizers, as well as strategies to determine the best batch size are discussed.

[Go to single CUDA training section](perf_train_cuda_one)

### Multi-CUDA

In some cases training on a single CUDA is still too slow or won't fit the large model. Moving to a multi-CUDA setup is the logical step, but training on multiple CUDAs at once comes with new decisions: does each CUDA have a full copy of the model or is the model itself also distributed? In this section we look at data, tensor, and pipeline parallism.

[Go to multi-CUDA training section](perf_train_cuda_many)

### CPU


[Go to CPU training section](perf_train_cpu)

### XPU


[Go to XPU training section](perf_train_xpu)

### Multi-XPU


[Go to multi-XPU training section](perf_train_xpu_many)


### TPU

[_Coming soon_](perf_train_tpu)

### Specialized Hardware

[_Coming soon_](perf_train_special)

## Inference

Efficient inference with large models in a production environment can be as challenging as training them. In the following sections we go through the steps to run inference on CPU and single/multi-CUDA setups.

### CPU

[Go to CPU inference section](perf_infer_cpu)

### Single XPU

[Go to single XPU inference section](perf_infer_xpu_one)

### Single CUDA

[Go to single CUDA inference section](perf_infer_cuda_one)

### Multi-CUDA

[Go to multi-CUDA inference section](perf_infer_cuda_many)

### Specialized Hardware

[_Coming soon_](perf_infer_special)

## Hardware

In the hardware section you can find tips and tricks when building your own deep learning rig.

[Go to hardware section](perf_hardware)


## Contribute

This document is far from being complete and a lot more needs to be added, so if you have additions or corrections to make please don't hesitate to open a PR or if you aren't sure start an Issue and we can discuss the details there.

When making contributions that A is better than B, please try to include a reproducible benchmark and/or a link to the source of that information (unless it comes directly from you).
